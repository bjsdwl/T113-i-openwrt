/dts-v1/;

/ {
    model = "Tronlong TLT113-MiniEVM (OpenWrt)";
    compatible = "tronlong,tlt113-minievm", "allwinner,sun8i-t113s", "allwinner,sun8i";

    #address-cells = <1>;
    #size-cells = <1>;

    interrupt-parent = <&gic>;

    aliases {
        serial0 = &uart0;
        ethernet0 = &emac;
        mmc0 = &mmc0;
    };

    chosen {
        stdout-path = "serial0:115200n8";
    };

    /* 架构定时器：解决 timer_probe 失败的关键 */
    timer {
        compatible = "arm,armv7-timer";
        interrupts = <1 13 0xf08>, /* Secure Phys IRQ */
                     <1 14 0xf08>, /* Non-secure Phys IRQ */
                     <1 11 0xf08>, /* Virtual IRQ */
                     <1 10 0xf08>; /* Hypervisor IRQ */
        interrupt-parent = <&gic>;
    };

    reserved-memory {
        #address-cells = <1>;
        #size-cells = <1>;
        ranges;

        /* 避开 OP-TEE 区域 */
        optee_reserve: optee@41c00000 {
            reg = <0x41c00000 0x1000000>;
            no-map;
        };
    };

    cpus {
        #address-cells = <1>;
        #size-cells = <0>;

        cpu0: cpu@0 {
            compatible = "arm,cortex-a7";
            device_type = "cpu";
            reg = <0>;
            clocks = <&ccu 0>;
        };

        cpu1: cpu@1 {
            compatible = "arm,cortex-a7";
            device_type = "cpu";
            reg = <1>;
            clocks = <&ccu 0>;
        };
    };

    osc24M: osc24M_clk {
        #clock-cells = <0>;
        compatible = "fixed-clock";
        clock-frequency = <24000000>;
        clock-output-names = "osc24M";
    };

    osc32k: osc32k_clk {
        #clock-cells = <0>;
        compatible = "fixed-clock";
        clock-frequency = <32768>;
        clock-output-names = "osc32k";
    };

    reg_vcc3v3: vcc3v3 {
        compatible = "regulator-fixed";
        regulator-name = "vcc3v3";
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;
        regulator-always-on;
    };

    leds {
        compatible = "gpio-leds";
        led0 {
            label = "tlt113:green:heartbeat";
            gpios = <&pio 2 0 0>; /* PC0 */
            linux,default-trigger = "heartbeat";
        };
    };

    soc {
        compatible = "simple-bus";
        #address-cells = <1>;
        #size-cells = <1>;
        ranges;

        gic: interrupt-controller@3021000 {
            compatible = "arm,gic-400";
            reg = <0x03021000 0x1000>,
                  <0x03022000 0x2000>,
                  <0x03024000 0x2000>,
                  <0x03026000 0x2000>;
            interrupt-controller;
            #interrupt-cells = <3>;
            device_type = "interrupt-controller";
        };

        ccu: clock-controller@2001000 {
            compatible = "allwinner,sun20i-d1-ccu";
            reg = <0x02001000 0x1000>;
            clocks = <&osc24M>, <&osc32k>;
            clock-names = "hosc", "losc";
            #clock-cells = <1>;
            #reset-cells = <1>;
        };

        pio: pinctrl@2000000 {
            compatible = "allwinner,sun20i-d1-pinctrl";
            reg = <0x02000000 0x800>;
            interrupts = <0 14 4>, <0 15 4>;
            clocks = <&ccu 13>, <&osc24M>, <&osc32k>;
            clock-names = "apb", "hosc", "losc";
            gpio-controller;
            #gpio-cells = <3>;
            interrupt-controller;
            #interrupt-cells = <3>;

            uart0_pg_pins: uart0-pg-pins {
                pins = "PG17", "PG18";
                function = "uart0";
            };

            mmc0_pins: mmc0-pins {
                pins = "PF0", "PF1", "PF2", "PF3", "PF4", "PF5";
                function = "mmc0";
                drive-strength = <30>;
                bias-pull-up;
            };
        };

        uart0: serial@2500000 {
            compatible = "snps,dw-apb-uart";
            reg = <0x02500000 0x400>;
            interrupts = <0 2 4>;
            reg-shift = <2>;
            reg-io-width = <4>;
            clocks = <&ccu 62>;
            resets = <&ccu 18>;
            status = "okay";
            pinctrl-names = "default";
            pinctrl-0 = <&uart0_pg_pins>;
        };

        mmc0: mmc@4020000 {
            compatible = "allwinner,sun20i-d1-mmc";
            reg = <0x04020000 0x1000>;
            interrupts = <0 39 4>;
            clocks = <&ccu 59>, <&ccu 56>;
            clock-names = "ahb", "mmc";
            resets = <&ccu 15>;
            reset-names = "ahb";
            pinctrl-names = "default";
            pinctrl-0 = <&mmc0_pins>;
            vmmc-supply = <&reg_vcc3v3>;
            bus-width = <4>;
            cd-gpios = <&pio 5 6 1>; /* PF6 */
            status = "okay";
        };

        emac: ethernet@4500000 {
            compatible = "allwinner,sun20i-d1-emac";
            reg = <0x04500000 0x10000>;
            interrupts = <0 46 4>;
            interrupt-names = "macirq";
            clocks = <&ccu 77>;
            clock-names = "stmmaceth";
            resets = <&ccu 30>;
            reset-names = "stmmaceth";
            status = "disabled"; /* 暂时关闭以防干扰，进系统后再开 */
        };
    };
};
